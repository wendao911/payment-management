# Payments 页面

## 概述

Payments 页面是应付管理系统的核心页面，负责管理应付账款和付款记录。该页面已经按照 BankAccounts 的代码结构进行了重构，提高了代码的可维护性和可读性。

## 目录结构

```
Payments/
├── components/           # 组件目录
│   ├── PaymentsTable.js # 主表格组件
│   ├── PayableModal.js  # 应付管理模态框
│   ├── PaymentRecordModal.js # 付款记录模态框
│   ├── PayableDetailModal.js # 应付详情模态框
│   ├── PaymentRecordDetailModal.js # 付款记录详情模态框
│   └── SearchForm.js    # 搜索表单组件
├── hooks/               # 自定义 hooks 目录
│   ├── usePayables.js   # 应付管理相关逻辑
│   ├── usePaymentRecords.js # 付款记录相关逻辑
│   ├── useWarnings.js   # 预警相关逻辑
│   ├── useCurrencies.js # 货币相关逻辑
│   ├── useSuppliers.js  # 供应商相关逻辑
│   └── useContracts.js  # 合同相关逻辑
├── styles/              # 样式目录
│   └── index.js         # 表格样式、列配置和所有样式定义（已合并原 styles.js）
├── utils/               # 工具函数目录
│   └── helpers.js       # 通用工具函数
├── Payments.js          # 主页面组件
├── index.js             # 页面入口
└── README.md            # 本文档
```

## 重构特点

### 1. 自定义 Hooks

- **usePayables**: 管理应付账款的核心逻辑，包括增删改查、搜索、预警过滤等
- **usePaymentRecords**: 管理付款记录的逻辑，包括增删改查等操作
- **useWarnings**: 管理预警数据的获取
- **useCurrencies**: 管理货币数据的获取
- **useSuppliers**: 管理供应商数据的获取
- **useContracts**: 管理合同数据的获取和树形结构转换

### 2. 组件化设计

- **PaymentsTable**: 将复杂的表格逻辑提取为独立组件，提高可维护性
- 保持了原有的展开行功能，显示付款记录详情

### 3. 样式管理

- **styles/index.js**: 集中管理表格样式和列配置
- 支持动态列配置，便于维护和扩展

### 4. 工具函数

- **utils/helpers.js**: 提取通用的工具函数，如数据验证、货币转换、合同查找等

## 主要功能

### 应付管理
- 新增、编辑、删除应付账款
- 搜索和过滤功能
- 状态管理（待付款、部分付款、已付款、逾期）
- 重要性和紧急程度标记

### 付款记录管理
- 为应付账款添加付款记录
- 查看、编辑、删除付款记录
- 支持附件上传

### 预警系统
- 逾期付款预警
- 即将到期付款提醒
- 重要付款标记

### 数据展示
- 支持多币种显示
- 自动计算剩余金额
- 树形结构展示合同信息
- 响应式表格设计

## 技术特点

1. **状态管理**: 使用 React Hooks 进行状态管理，逻辑清晰
2. **错误处理**: 完善的错误处理和用户提示
3. **性能优化**: 使用 useCallback 优化函数性能
4. **类型安全**: 虽然使用 JavaScript，但通过良好的命名约定保证代码质量
5. **响应式设计**: 支持不同屏幕尺寸的显示

## 使用说明

### 基本操作
1. **查看应付账款**: 页面加载后自动显示所有应付账款
2. **新增应付**: 点击"新增应付"按钮创建新的应付账款
3. **编辑应付**: 点击操作列中的"编辑"按钮修改应付信息
4. **查看详情**: 点击"查看"按钮查看应付账款的详细信息
5. **管理付款记录**: 展开行查看付款记录，可以添加、编辑、删除

### 搜索功能
- 支持按应付编号、供应商、合同、状态等条件搜索
- 支持日期范围搜索
- 支持重要性和紧急程度过滤

### 预警功能
- 页面顶部显示预警统计卡片
- 点击预警卡片可以快速过滤相关数据

## 注意事项

1. **数据刷新**: 编辑或删除操作后会自动刷新相关数据
2. **权限控制**: 确保用户有相应的操作权限
3. **数据验证**: 前端会进行基本的数据验证，但后端验证是最终保障
4. **错误处理**: 网络错误或服务器错误会有相应的用户提示

## 扩展建议

1. **批量操作**: 可以添加批量编辑、批量删除等功能
2. **数据导出**: 可以添加数据导出功能
3. **审批流程**: 可以集成审批流程系统
4. **报表功能**: 可以添加统计报表功能
5. **移动端适配**: 可以进一步优化移动端显示效果
